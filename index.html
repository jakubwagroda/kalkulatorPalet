<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vesuvius Truck Loading Calculator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --vesuvius-primary: #B14C08;
            --vesuvius-rust: #802414;
            --vesuvius-burnt-orange: #D27336;
            --vesuvius-red: #F33B28;
            --vesuvius-tan: #9F715D;
            --vesuvius-light-orange: #F3B36C;
            --vesuvius-dark: #260E0B;
        }
        body {
            background: linear-gradient(135deg, #FFF5EE 0%, #FFE4D1 100%);
        }
        .vesuvius-gradient {
            background: linear-gradient(135deg, var(--vesuvius-primary) 0%, var(--vesuvius-rust) 100%);
        }
        .vesuvius-btn {
            background: var(--vesuvius-primary);
            transition: all 0.3s ease;
        }
        .vesuvius-btn:hover {
            background: var(--vesuvius-rust);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(177, 76, 8, 0.3);
        }
        .vesuvius-header {
            background: linear-gradient(135deg, var(--vesuvius-primary) 0%, var(--vesuvius-burnt-orange) 100%);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Ikony SVG
        const TruckIcon = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M1 3h15v13H1zM16 8h4l3 3v5h-7V8z" />
                <circle cx="5.5" cy="18.5" r="2.5" />
                <circle cx="18.5" cy="18.5" r="2.5" />
            </svg>
        );

        const PackageIcon = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
            </svg>
        );

        const CheckCircleIcon = () => (
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
        );

        const XCircleIcon = () => (
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10" />
                <line x1="15" y1="9" x2="9" y2="15" />
                <line x1="9" y1="9" x2="15" y2="15" />
            </svg>
        );

        const RotateCwIcon = ({ size = 12 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 4 23 10 17 10" />
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
            </svg>
        );

        // Komponent wizualizacji
        function TruckVisualization({ truckLength, truckWidth, packedPalettes }) {
            const maxWidth = 1000;
            const maxHeight = 600;
            
            const scaleX = maxWidth / truckLength;
            const scaleY = maxHeight / truckWidth;
            const scale = Math.min(scaleX, scaleY) * 0.9;
            
            const svgWidth = truckLength * scale;
            const svgHeight = truckWidth * scale;
            
            // Vesuvius color palette
            const colors = [
                '#B14C08', '#F33B28', '#D27336', '#F3B36C', '#802414',
                '#9F715D', '#B14C08', '#F33B28', '#D27336', '#F3B36C',
                '#802414', '#9F715D', '#B14C08', '#F33B28', '#D27336'
            ];
            
            return (
                <div className="bg-white p-6 rounded-xl border-2" style={{ borderColor: '#D27336' }}>
                    <div className="overflow-x-auto">
                        <svg 
                            width={svgWidth} 
                            height={svgHeight}
                            className="mx-auto border-2 bg-gray-50"
                            style={{ minWidth: '600px', borderColor: '#802414' }}
                        >
                            <rect 
                                x="0" 
                                y="0" 
                                width={svgWidth} 
                                height={svgHeight}
                                fill="#FFF5EE"
                                stroke="#802414"
                                strokeWidth="3"
                            />
                            
                            {Array.from({ length: Math.floor(truckLength / 100) }).map((_, i) => (
                                <line
                                    key={`grid-v-${i}`}
                                    x1={(i + 1) * 100 * scale}
                                    y1="0"
                                    x2={(i + 1) * 100 * scale}
                                    y2={svgHeight}
                                    stroke="#e5e7eb"
                                    strokeWidth="1"
                                    strokeDasharray="4,4"
                                />
                            ))}
                            {Array.from({ length: Math.floor(truckWidth / 100) }).map((_, i) => (
                                <line
                                    key={`grid-h-${i}`}
                                    x1="0"
                                    y1={(i + 1) * 100 * scale}
                                    x2={svgWidth}
                                    y2={(i + 1) * 100 * scale}
                                    stroke="#e5e7eb"
                                    strokeWidth="1"
                                    strokeDasharray="4,4"
                                />
                            ))}
                            
                            {packedPalettes.map((palette, index) => {
                                const x = palette.x * scale;
                                const y = palette.y * scale;
                                const width = palette.placedLength * scale;
                                const height = palette.placedWidth * scale;
                                const color = colors[palette.originalId % colors.length];
                                
                                return (
                                    <g key={index}>
                                        <rect
                                            x={x}
                                            y={y}
                                            width={width}
                                            height={height}
                                            fill={color}
                                            fillOpacity="0.7"
                                            stroke={color}
                                            strokeWidth="2"
                                        />
                                        
                                        <text
                                            x={x + width / 2}
                                            y={y + height / 2}
                                            textAnchor="middle"
                                            dominantBaseline="middle"
                                            fill="white"
                                            fontSize="14"
                                            fontWeight="bold"
                                            style={{ textShadow: '1px 1px 2px rgba(0,0,0,0.8)' }}
                                        >
                                            #{palette.originalId}
                                            {palette.quantity > 1 && `/${palette.instanceNumber}`}
                                        </text>
                                        
                                        <text
                                            x={x + width / 2}
                                            y={y + height / 2 + 18}
                                            textAnchor="middle"
                                            dominantBaseline="middle"
                                            fill="white"
                                            fontSize="11"
                                            fontWeight="normal"
                                            style={{ textShadow: '1px 1px 2px rgba(0,0,0,0.8)' }}
                                        >
                                            {palette.placedLength}×{palette.placedWidth}
                                        </text>
                                        
                                        {palette.rotated && (
                                            <text
                                                x={x + 8}
                                                y={y + 18}
                                                fill="white"
                                                fontSize="16"
                                                style={{ textShadow: '1px 1px 2px rgba(0,0,0,0.8)' }}
                                            >
                                                ↻
                                            </text>
                                        )}
                                    </g>
                                );
                            })}
                        </svg>
                    </div>
                    
                    <div className="mt-4 flex flex-wrap gap-4 justify-center">
                        <div className="flex items-center gap-2 text-sm">
                            <div className="w-4 h-4 border-2" style={{ background: '#FFF5EE', borderColor: '#802414' }}></div>
                            <span>Truck bed: {truckLength} × {truckWidth} cm</span>
                        </div>
                        <div className="flex items-center gap-2 text-sm">
                            <div className="w-4 h-4 opacity-70" style={{ background: '#B14C08' }}></div>
                            <span>Pallets (colored)</span>
                        </div>
                        <div className="flex items-center gap-2 text-sm">
                            <span>↻</span>
                            <span>Rotated pallet</span>
                        </div>
                    </div>
                    
                    <div className="mt-4 text-center text-sm" style={{ color: '#802414' }}>
                        Scale: 1:{Math.round(1/scale)} | Grid lines every 100 cm (1 meter)
                    </div>
                </div>
            );
        }

        // Główna aplikacja
        function TruckPackingApp() {
            const [truckLength, setTruckLength] = useState(1350);
            const [truckWidth, setTruckWidth] = useState(245);
            const [truckHeight, setTruckHeight] = useState(270);
            const [palettes, setPalettes] = useState([]);
            const [result, setResult] = useState(null);

            const addPalette = () => {
                setPalettes([...palettes, { 
                    id: palettes.length + 1, 
                    length: 120, 
                    width: 80,
                    height: 150,
                    quantity: 1
                }]);
            };

            const removePalette = (id) => {
                setPalettes(palettes.filter(p => p.id !== id));
            };

            const updatePalette = (id, field, value) => {
                setPalettes(palettes.map(p => 
                    p.id === id ? { ...p, [field]: parseFloat(value) || 0 } : p
                ));
            };

            const packPalettes = () => {
                const truck = {
                    length: truckLength,
                    width: truckWidth,
                    height: truckHeight,
                    area: truckLength * truckWidth
                };

                const expandedPalettes = [];
                palettes.forEach(palette => {
                    for (let i = 0; i < (palette.quantity || 1); i++) {
                        expandedPalettes.push({
                            ...palette,
                            originalId: palette.id,
                            instanceNumber: i + 1,
                            area: palette.length * palette.width
                        });
                    }
                });

                const sortedPalettes = expandedPalettes.sort((a, b) => b.area - a.area);

                let packed = [];
                let freeRects = [{ x: 0, y: 0, width: truck.length, height: truck.width }];

                for (let palette of sortedPalettes) {
                    let bestRect = null;
                    let bestOrientation = null;
                    let bestScore = Infinity;
                    
                    const orientations = [
                        { length: palette.length, width: palette.width, rotated: false },
                        { length: palette.width, width: palette.length, rotated: true }
                    ];

                    for (let rect of freeRects) {
                        for (let orientation of orientations) {
                            if (orientation.length <= rect.width && orientation.width <= rect.height) {
                                const wastedArea = (rect.width * rect.height) - (orientation.length * orientation.width);
                                
                                if (wastedArea < bestScore) {
                                    bestScore = wastedArea;
                                    bestRect = rect;
                                    bestOrientation = orientation;
                                }
                            }
                        }
                    }

                    if (!bestRect) {
                        const totalPalettes = expandedPalettes.length;
                        setResult({
                            success: false,
                            packed: packed,
                            unpacked: sortedPalettes.slice(packed.length),
                            utilization: (packed.reduce((sum, p) => sum + p.area, 0) / truck.area * 100).toFixed(2),
                            totalPalettes: totalPalettes
                        });
                        return;
                    }

                    packed.push({
                        ...palette,
                        x: bestRect.x,
                        y: bestRect.y,
                        placedLength: bestOrientation.length,
                        placedWidth: bestOrientation.width,
                        rotated: bestOrientation.rotated
                    });

                    freeRects = freeRects.filter(r => r !== bestRect);

                    if (bestRect.x + bestOrientation.length < bestRect.x + bestRect.width) {
                        freeRects.push({
                            x: bestRect.x + bestOrientation.length,
                            y: bestRect.y,
                            width: bestRect.width - bestOrientation.length,
                            height: bestRect.height
                        });
                    }

                    if (bestRect.y + bestOrientation.width < bestRect.y + bestRect.height) {
                        freeRects.push({
                            x: bestRect.x,
                            y: bestRect.y + bestOrientation.width,
                            width: bestOrientation.length,
                            height: bestRect.height - bestOrientation.width
                        });
                    }

                    freeRects = freeRects.filter((rect) => {
                        if (rect.width <= 0 || rect.height <= 0) return false;
                        if (rect.x + rect.width > truck.length || rect.y + rect.height > truck.width) return false;
                        return true;
                    });
                }

                const maxY = Math.max(...packed.map(p => p.y + p.placedWidth));
                
                setResult({
                    success: true,
                    packed: packed,
                    unpacked: [],
                    utilization: (packed.reduce((sum, p) => sum + p.area, 0) / truck.area * 100).toFixed(2),
                    usedHeight: maxY,
                    totalPalettes: expandedPalettes.length
                });
            };

            return (
                <div className="min-h-screen p-8" style={{ background: 'linear-gradient(135deg, #FFF5EE 0%, #FFE4D1 100%)' }}>
                    <div className="max-w-6xl mx-auto">
                        {/* Vesuvius Header */}
                        <div className="vesuvius-header rounded-2xl shadow-2xl p-6 mb-6 text-white">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <div className="bg-white rounded-lg p-3">
                                        <svg width="48" height="48" viewBox="0 0 100 100" fill="none">
                                            <circle cx="50" cy="50" r="45" fill="#B14C08"/>
                                            <path d="M30 70 L50 30 L70 70 Z" fill="#F3B36C"/>
                                            <circle cx="50" cy="45" r="8" fill="#F33B28"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold">VESUVIUS</h1>
                                        <p className="text-lg opacity-90">Truck Loading Calculator</p>
                                    </div>
                                </div>
                                <TruckIcon />
                            </div>
                        </div>

                        <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                            <div className="mb-8 p-6 rounded-xl" style={{ background: 'linear-gradient(135deg, #FFF5EE 0%, #FFE4D1 100%)' }}>
                                <h2 className="text-xl font-semibold mb-4" style={{ color: '#802414' }}>
                                    Truck Bed Dimensions
                                </h2>
                                <div className="grid grid-cols-3 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2" style={{ color: '#802414' }}>
                                            Length (cm)
                                        </label>
                                        <input
                                            type="number"
                                            value={truckLength}
                                            onChange={(e) => setTruckLength(parseFloat(e.target.value) || 0)}
                                            className="w-full px-4 py-2 border-2 rounded-lg focus:ring-2 focus:border-transparent"
                                            style={{ borderColor: '#D27336', outline: 'none' }}
                                            onFocus={(e) => e.target.style.borderColor = '#B14C08'}
                                            onBlur={(e) => e.target.style.borderColor = '#D27336'}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2" style={{ color: '#802414' }}>
                                            Width (cm)
                                        </label>
                                        <input
                                            type="number"
                                            value={truckWidth}
                                            onChange={(e) => setTruckWidth(parseFloat(e.target.value) || 0)}
                                            className="w-full px-4 py-2 border-2 rounded-lg focus:ring-2 focus:border-transparent"
                                            style={{ borderColor: '#D27336', outline: 'none' }}
                                            onFocus={(e) => e.target.style.borderColor = '#B14C08'}
                                            onBlur={(e) => e.target.style.borderColor = '#D27336'}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2" style={{ color: '#802414' }}>
                                            Height (cm)
                                        </label>
                                        <input
                                            type="number"
                                            value={truckHeight}
                                            onChange={(e) => setTruckHeight(parseFloat(e.target.value) || 0)}
                                            className="w-full px-4 py-2 border-2 rounded-lg focus:ring-2 focus:border-transparent"
                                            style={{ borderColor: '#D27336', outline: 'none' }}
                                            onFocus={(e) => e.target.style.borderColor = '#B14C08'}
                                            onBlur={(e) => e.target.style.borderColor = '#D27336'}
                                        />
                                    </div>
                                </div>
                                <div className="mt-3 text-sm" style={{ color: '#802414' }}>
                                    Area: {(truckLength * truckWidth / 10000).toFixed(2)} m² | Volume: {(truckLength * truckWidth * truckHeight / 1000000).toFixed(2)} m³
                                </div>
                            </div>

                            <div className="mb-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-semibold" style={{ color: '#802414' }}>Pallets</h2>
                                    <button
                                        onClick={addPalette}
                                        className="flex items-center gap-2 px-4 py-2 text-white rounded-lg vesuvius-btn"
                                    >
                                        <PackageIcon />
                                        Add Pallet
                                    </button>
                                </div>

                                <div className="space-y-3">
                                    {palettes.map((palette, index) => (
                                        <div key={palette.id} className="flex items-center gap-4 p-4 rounded-lg" style={{ background: '#FFF5EE' }}>
                                            <div className="font-semibold w-8" style={{ color: '#802414' }}>#{index + 1}</div>
                                            <div className="flex-1 grid grid-cols-4 gap-3">
                                                <div>
                                                    <label className="block text-xs mb-1" style={{ color: '#802414' }}>Length (cm)</label>
                                                    <input
                                                        type="number"
                                                        value={palette.length}
                                                        onChange={(e) => updatePalette(palette.id, 'length', e.target.value)}
                                                        className="w-full px-3 py-2 border-2 rounded-lg"
                                                        style={{ borderColor: '#D27336' }}
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-xs mb-1" style={{ color: '#802414' }}>Width (cm)</label>
                                                    <input
                                                        type="number"
                                                        value={palette.width}
                                                        onChange={(e) => updatePalette(palette.id, 'width', e.target.value)}
                                                        className="w-full px-3 py-2 border-2 rounded-lg"
                                                        style={{ borderColor: '#D27336' }}
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-xs mb-1" style={{ color: '#802414' }}>Height (cm)</label>
                                                    <input
                                                        type="number"
                                                        value={palette.height}
                                                        onChange={(e) => updatePalette(palette.id, 'height', e.target.value)}
                                                        className="w-full px-3 py-2 border-2 rounded-lg"
                                                        style={{ borderColor: '#D27336' }}
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-xs mb-1" style={{ color: '#802414' }}>Quantity (pcs)</label>
                                                    <input
                                                        type="number"
                                                        min="1"
                                                        value={palette.quantity}
                                                        onChange={(e) => updatePalette(palette.id, 'quantity', e.target.value)}
                                                        className="w-full px-3 py-2 border-2 rounded-lg"
                                                        style={{ borderColor: '#D27336' }}
                                                    />
                                                </div>
                                            </div>
                                            <div className="text-sm w-24" style={{ color: '#802414' }}>
                                                {(palette.length * palette.width / 10000).toFixed(2)} m²
                                            </div>
                                            <button
                                                onClick={() => removePalette(palette.id)}
                                                className="px-3 py-2 text-white rounded-lg transition"
                                                style={{ background: '#F33B28' }}
                                                onMouseOver={(e) => e.target.style.background = '#802414'}
                                                onMouseOut={(e) => e.target.style.background = '#F33B28'}
                                            >
                                                Remove
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <button
                                onClick={packPalettes}
                                disabled={palettes.length === 0}
                                className="w-full py-4 text-white text-lg font-semibold rounded-xl transition disabled:bg-gray-300 disabled:cursor-not-allowed vesuvius-btn"
                            >
                                Calculate Loading Capacity
                            </button>
                        </div>

                        {result && (
                            <div className={`bg-white rounded-2xl shadow-xl p-8 ${
                                result.success ? 'border-4' : 'border-4'
                            }`} style={{ borderColor: result.success ? '#10b981' : '#F33B28' }}>
                                <div className="flex items-center gap-4 mb-6">
                                    {result.success ? (
                                        <>
                                            <CheckCircleIcon />
                                            <div>
                                                <h2 className="text-2xl font-bold text-green-700">
                                                    All pallets will fit!
                                                </h2>
                                                <p className="text-gray-600">Space utilization: {result.utilization}%</p>
                                                <p className="text-gray-600">Total pallets: {result.totalPalettes} pcs</p>
                                            </div>
                                        </>
                                    ) : (
                                        <>
                                            <XCircleIcon />
                                            <div>
                                                <h2 className="text-2xl font-bold" style={{ color: '#F33B28' }}>
                                                    Not all pallets will fit
                                                </h2>
                                                <p className="text-gray-600">
                                                    Fitted: {result.packed.length}/{result.totalPalettes} pallets
                                                </p>
                                            </div>
                                        </>
                                    )}
                                </div>

                                <div className="grid grid-cols-2 gap-6">
                                    <div>
                                        <h3 className="text-lg font-semibold mb-3 text-green-700">
                                            ✓ Packed ({result.packed.length})
                                        </h3>
                                        <div className="space-y-2">
                                            {result.packed.map((p, idx) => (
                                                <div key={idx} className="p-3 bg-green-50 rounded-lg text-sm">
                                                    <div className="font-semibold">
                                                        Pallet #{p.originalId}
                                                        {p.quantity > 1 && <span className="text-gray-500"> (pc. {p.instanceNumber}/{p.quantity})</span>}
                                                    </div>
                                                    <div className="text-gray-600">
                                                        {p.placedLength} × {p.placedWidth} × {p.height} cm
                                                        {p.rotated && (
                                                            <span className="ml-2 inline-flex items-center gap-1" style={{ color: '#B14C08' }}>
                                                                <RotateCwIcon size={12} />
                                                                rotated
                                                            </span>
                                                        )}
                                                    </div>
                                                    <div className="text-xs text-gray-500">
                                                        Position: x={p.x}cm, y={p.y}cm
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {result.unpacked.length > 0 && (
                                        <div>
                                            <h3 className="text-lg font-semibold mb-3" style={{ color: '#F33B28' }}>
                                                ✗ Did not fit ({result.unpacked.length})
                                            </h3>
                                            <div className="space-y-2">
                                                {result.unpacked.map((p, idx) => (
                                                    <div key={idx} className="p-3 rounded-lg text-sm" style={{ background: '#FFE4D1' }}>
                                                        <div className="font-semibold">
                                                            Pallet #{p.originalId}
                                                            {p.quantity > 1 && <span className="text-gray-500"> (pc. {p.instanceNumber}/{p.quantity})</span>}
                                                        </div>
                                                        <div className="text-gray-600">
                                                            {p.length} × {p.width} × {p.height} cm
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {result.success && (
                                    <div className="mt-6 p-4 rounded-lg" style={{ background: 'linear-gradient(135deg, #FFF5EE 0%, #FFE4D1 100%)' }}>
                                        <h3 className="font-semibold mb-2" style={{ color: '#802414' }}>Statistics:</h3>
                                        <div className="text-sm text-gray-700 space-y-1">
                                            <div>• Used truck bed height: {result.usedHeight} cm of {truckWidth} cm</div>
                                            <div>• Space utilization: {result.utilization}%</div>
                                            <div>• Number of pallets: {result.packed.length}</div>
                                            <div>• Number of rotations: {result.packed.filter(p => p.rotated).length}</div>
                                        </div>
                                    </div>
                                )}

                                {result && result.packed.length > 0 && (
                                    <div className="mt-6">
                                        <h3 className="text-lg font-semibold mb-4" style={{ color: '#802414' }}>
                                            Loading Visualization (top view)
                                        </h3>
                                        <TruckVisualization 
                                            truckLength={truckLength}
                                            truckWidth={truckWidth}
                                            packedPalettes={result.packed}
                                        />
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TruckPackingApp />, document.getElementById('root'));
    </script>
</body>
</html>
